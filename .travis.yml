---
language: ruby
rvm:
  - 2.1
script: bundle exec middleman build
branches:
  only:
    - source

env:
  global:
    - GIT_COMMITTER_NAME=travis
    - GIT_COMMITTER_EMAIL=tmd45@otegami.jpn.org
    - GIT_AUTHOR_NAME=tmd45
    - GIT_AUTHOR_EMAIL=tmd45@otegami.jpn.org
    - secure: lLkBjK4mOwMG/tRc8yzv4Nlw2vxS1LbRagwsGk2ZMHmt2aCtSEKobuVG9AbTI6b0nZvQKLv2ceDaBUNQWAX39rw07ESLB1qjAtn3RsllNjxIxZgO7nhMptbnFu603yLEtp3/1i8oZbbur9Kxk+3mpeAOzkVQzGHN5g8RQtFg2RQ=

before_script:
  - git clone --quiet http://github.com/tmd45/tmd45.github.io.git build
  - pushd build
  - git checkout
  - popd

after_success:
  - cd build
  - echo -e "---\nbranches:\n  only:\n    - source" > .travis.yml
  - git add -A
  - git commit -m 'Update'
  - '[ $GH_TOKEN ] && git push --quiet https://$GH_TOKEN@github.com/tmd45/tmd45.github.io.git 2> /dev/null'
